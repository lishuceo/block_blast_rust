# 动态关卡机制初步想法 (基于回合数)

## 核心目标

通过引入基于玩家放置方块次数（回合数）的动态难度调整和周期性挑战，提升游戏的节奏感、爽快感和长期可玩性，替代当前相对平稳的游戏进程。爽感的营造不仅依赖于难度降低，更要通过**惊喜解围、布局引导、危机化解和强化反馈**来实现，并保证玩家的成功主要源于对标准方块的运用技巧。

## 机制设计：节奏波

游戏节奏围绕"回合数"（成功放置一个方块计为 1 回合）展开，并在不同阶段间周期性切换，形成"节奏波"。

### 1. 回合计数器

-   在 `Game` 结构体中添加 `turn_count: u32` 字段。
-   每次成功放置方块后，`turn_count += 1`。

### 2. 基础难度演进

-   游戏的基础难度随 `turn_count` 增加而缓慢提升。
-   提升方式：
    -   逐渐增加每次生成的方块数量 (`blocks_per_generation`)。
    -   调整方块池，降低简单方块概率，增加复杂方块概率。
-   通过检查 `turn_count` 的范围来触发难度提升。

### 3. 波次阶段与转换 (基于回合)

游戏在以下阶段间循环切换，由 `turn_count` 触发：

-   **积累阶段 (波谷):**
    -   难度相对平稳或略低，方块复杂度较低。
    -   目标：让玩家清理棋盘、积累分数/连击、建立信心。
    -   **(新增) 惊喜解围机制 (低概率触发):**
        -   *情景感知型生成 (可选高级):* 系统概率性分析棋盘拥堵情况，生成能"解围"的**标准形状**方块。
    -   **(新增) 引导连消布局:**
        -   *方块组合设计:* 生成的方块组在形状上倾向于可以互相配合、嵌套或轻松排列以消除多行/列。
        -   *"暗示性"生成:* 引导玩家发现多行消除的可能性。
-   **挑战预告:**
    -   在挑战阶段开始前 1-2 回合，给出视觉或听觉提示。
-   **挑战阶段 (波峰):**
    -   难度显著提升，持续固定回合数（例如 5 回合）。
    -   **挑战类型 (随机或轮流):**
        -   **方块潮:** 每回合生成更多、更大或更不规则的**标准**方块。
        -   **精准消除任务:** 指定特定行/列，在挑战回合内消除可获高额奖励。
        -   **高价值方块组:** 生成分数高但形状奇特的**标准**方块组。
    -   目标：考验玩家的空间管理、快速决策和消除技巧。
-   **缓和阶段:**
    -   挑战结束后，难度暂时回落，持续少量回合。
    -   目标：给玩家喘息和整理棋盘的时间。
    -   **(新增)** 可适当提高"惊喜解围"（生成有用的标准方块）的概率。
-   **下一轮积累:**
    -   进入新的循环，基础难度可能略高于上一轮。

### 4. 提升"爽感"的要点 (贯穿各阶段)

-   **惊喜与解围:** 利用情景感知生成（标准方块）创造"柳暗花明"的时刻。
-   **布局引导与成就:** 通过巧妙的标准方块组合让玩家更容易打出高连击/多行消除，获得掌控感和成就感。
-   **危机化解:** 在高压下成功消除（尤其是在挑战阶段或棋盘将满时）带来极大的满足感和放松感。可加入"极限操作"奖励。
-   **强化反馈机制:**
    -   *连击反馈:* 阶梯式增强的视听效果，可加入屏幕震动或强调效果。
    -   *多行/列消除反馈:* 触发远超单消的、独特的、更震撼的庆祝视听效果。
    -   *(可选)* 细微的"完美放置"提示，鼓励并奖励最优策略。

## 实现考量

-   `Game` 结构体需添加 `turn_count` 和 `WavePhase` 枚举。
-   `update_game` 需处理回合计数、阶段转换、情景感知（如果实现）逻辑。
-   `generate_blocks` 需根据 `WavePhase`、`turn_count` 和潜在的棋盘状态调整生成（**仅标准方块**）。
-   `grid.rs` 可能需添加棋盘状态分析（如果实现情景感知）逻辑。
-   `draw_game` 需添加反映阶段/任务/特殊状态的视觉元素。
-   `effects.rs` 提供更丰富、阶梯式增强的视觉特效。
-   需要设计或引入更丰富的音效资源配合强化反馈。 